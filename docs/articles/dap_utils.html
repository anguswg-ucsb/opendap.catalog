<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>R Utilites • opendap.catalog</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="R Utilites">
<meta property="og:description" content="opendap.catalog">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">opendap.catalog</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/index.html">Intro</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/dap_utils.html">R Utilites</a>
    </li>
    <li>
      <a href="../articles/catalog.html">OPeDAP catalog</a>
    </li>
    <li>
      <a href="../articles/xyt_aggregation.html">XYT aggregations</a>
    </li>
    <li>
      <a href="../articles/search.html">Catalog Search</a>
    </li>
    <li>
      <a href="../articles/future.html">Going Parallel</a>
    </li>
    <li>
      <a href="../articles/parameter_estimation.html">Parameter Estimation</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mikejohnson51/opendap.catalog/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>R Utilites</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mikejohnson51/opendap.catalog/blob/HEAD/vignettes/dap_utils.Rmd" class="external-link"><code>vignettes/dap_utils.Rmd</code></a></small>
      <div class="hidden name"><code>dap_utils.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mikejohnson51/opendap.catalog" class="external-link">opendap.catalog</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/terra/" class="external-link">terra</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></code></pre></div>
<p>This Vignette focuses on the generalized R tooling for getting data from local and remote NetCDF(-esque) resources.</p>
<div class="section level2">
<h2 id="general-examples">General Examples<a class="anchor" aria-label="anchor" href="#general-examples"></a>
</h2>
<p>A lot of data lives online, and a lot lives on our computers. For the sake of demonstrating the utilities we focus on NetCDF data that is:</p>
<ol style="list-style-type: decimal">
<li>Local</li>
<li>Web-Accessible <em>and</em> Web-subsettable (e.g. OpenDAP)</li>
<li>Web Data that must be downloaded</li>
</ol>
<p>In principle, 1 and 3 behave the same with respect to access. So this vignette highlights working with a large <em>local</em> data set and an aggregated web-accessible <em>remote</em> data set.</p>
<p>The basic utilities demonstrated are:</p>
<ul>
<li>
<code><a href="../reference/dap_summary.html">dap_summary()</a></code>: see whats in the data</li>
<li>
<code><a href="../reference/dap_crop.html">dap_crop()</a></code>: identify the subset of the data you want for a space and time</li>
<li>
<code><a href="../reference/dap_get.html">dap_get()</a></code>: get the identified data</li>
</ul>
<p>For cases where its applicable, these three utilities are wrapped in a single function</p>
<p>-<code><a href="../reference/dap.html">dap()</a></code></p>
<p>In many cases the local files we have contain more data then needed for analysis. In this example lets look at a data set with daily, Continental USA Solar Radiation data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">'/Users/mjohnson/Downloads/NEXGDM_srad_2020_v100.nc'</span>
<span class="co"># Size of file?</span>
<span class="fu">utils</span><span class="fu">:::</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">format.object_size</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.info.html" class="external-link">file.size</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span>, <span class="st">"auto"</span><span class="op">)</span>
<span class="co">#&gt; [1] "3.7 Gb"</span></code></pre></div>
<div class="section level3">
<h3 id="dap_summary">dap_summary()<a class="anchor" aria-label="anchor" href="#dap_summary"></a>
</h3>
<p><code><a href="../reference/dap_summary.html">dap_summary()</a></code> provides a convenient way to view the key details of resource, include the variables (units, and description), the X, Y, and T bounds, and the total number of values that would be extracted if the requested object was retrieved.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/dap_summary.html">dap_summary</a></span><span class="op">(</span>url <span class="op">=</span> <span class="va">url</span><span class="op">)</span>
<span class="co">#&gt; source:   /Users/mjohnson/Downloads/NEXGDM_srad_2020_v100.nc </span>
<span class="co">#&gt; varname(s):</span>
<span class="co">#&gt;    &gt; srad [MJ/day] (Shortwave radiation)</span>
<span class="co">#&gt; ==================================================</span>
<span class="co">#&gt; diminsions:  -4800, -3150, 366 (names: x,y,time)</span>
<span class="co">#&gt; resolution:  1000, 1000, 1 days</span>
<span class="co">#&gt; extent:      -2493045, 2306955, 3310005, 160005 (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs:         +proj=aea +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +u...</span>
<span class="co">#&gt; time:        2020-01-02 to 2021-01-01</span>
<span class="co">#&gt; ==================================================</span>
<span class="co">#&gt; values: 5,533,920,000 (vars*X*Y*T)</span></code></pre></div>
<p>In total the 3.7 GB file, contains 5,533,920,000 values. In most cases this is overkill for the task at hand. Say instead of the full spatial and temporal bounds we just wanted a subset? <code><a href="../reference/dap_crop.html">dap_crop()</a></code> provides a lazy way to define and examine a subset before making the request.</p>
</div>
<div class="section level3">
<h3 id="dap_crop">dap_crop()<a class="anchor" aria-label="anchor" href="#dap_crop"></a>
</h3>
<p><code><a href="../reference/dap_crop.html">dap_crop()</a></code> allows you to define the spatial and temporal extent of the data you want, prior to extracting data, and returns a <code>data.frame</code> with the meta data regrading that subset. By default (<code>verbose = TRUE</code>), <code><a href="../reference/dap_crop.html">dap_crop()</a></code> calls <code><a href="../reference/dap_summary.html">dap_summary()</a></code> internally.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Solar Radiation in January over Colorado</span>
<span class="va">cropped</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dap_crop.html">dap_crop</a></span><span class="op">(</span>URL <span class="op">=</span> <span class="va">url</span>, 
                    AOI <span class="op">=</span> <span class="fu">AOI</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/AOI/man/aoi_get.html" class="external-link">aoi_get</a></span><span class="op">(</span>state <span class="op">=</span> <span class="st">"Colorado"</span><span class="op">)</span>,
                    startDate <span class="op">=</span> <span class="st">"2020-01-01"</span>,  
                    endDate   <span class="op">=</span> <span class="st">"2020-01-31"</span><span class="op">)</span>
<span class="co">#&gt; source:   /Users/mjohnson/Downloads/NEXGDM_srad_2020_v100.nc </span>
<span class="co">#&gt; varname(s):</span>
<span class="co">#&gt;    &gt; srad [MJ/day] (Shortwave radiation)</span>
<span class="co">#&gt; ==================================================</span>
<span class="co">#&gt; diminsions:  643, 508, 30 (names: x,y,time)</span>
<span class="co">#&gt; resolution:  1000, 1000, 1 days</span>
<span class="co">#&gt; extent:      -1147045, -504045, 1566005, 2074005 (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs:         +proj=aea +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +u...</span>
<span class="co">#&gt; time:        2020-01-02 to 2020-01-31</span>
<span class="co">#&gt; ==================================================</span>
<span class="co">#&gt; values: 9,799,320 (vars*X*Y*T)</span></code></pre></div>
<p>The reported summary of the cropped object requires just .02% of the data from the entire resource:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">cropped</span><span class="op">)</span>
<span class="co">#&gt; Rows: 1</span>
<span class="co">#&gt; Columns: 25</span>
<span class="co">#&gt; $ id          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "local"</span>
<span class="co">#&gt; $ varname     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "srad"</span>
<span class="co">#&gt; $ X_name      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "x"</span>
<span class="co">#&gt; $ Y_name      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "y"</span>
<span class="co">#&gt; $ T_name      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "time"</span>
<span class="co">#&gt; $ units       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "MJ/day"</span>
<span class="co">#&gt; $ long_name   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Shortwave radiation"</span>
<span class="co">#&gt; $ URL         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "/Users/mjohnson/Downloads/NEXGDM_srad_2020_v100.nc?srad[0…</span>
<span class="co">#&gt; $ duration    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "2020-01-02/2021-01-01"</span>
<span class="co">#&gt; $ interval    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "1 days"</span>
<span class="co">#&gt; $ nT          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 366</span>
<span class="co">#&gt; $ proj        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "+proj=aea +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +units=m …</span>
<span class="co">#&gt; $ X1          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -1146545</span>
<span class="co">#&gt; $ Xn          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -504545</span>
<span class="co">#&gt; $ Y1          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1566505</span>
<span class="co">#&gt; $ Yn          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2073505</span>
<span class="co">#&gt; $ resX        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1000</span>
<span class="co">#&gt; $ resY        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1000</span>
<span class="co">#&gt; $ ncols       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 643</span>
<span class="co">#&gt; $ nrows       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 508</span>
<span class="co">#&gt; $ toptobottom <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> FALSE</span>
<span class="co">#&gt; $ tiled       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> ""</span>
<span class="co">#&gt; $ Tdim        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 30</span>
<span class="co">#&gt; $ startDate   <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span> 2020-01-02</span>
<span class="co">#&gt; $ endDate     <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span> 2020-01-31</span></code></pre></div>
<p>Aside from the descriptive data, the most critical element is the <code>URL</code> which is a formed OpenDAP call for the AOI and time of interest.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cropped</span><span class="op">$</span><span class="va">URL</span>
<span class="co">#&gt; [1] "/Users/mjohnson/Downloads/NEXGDM_srad_2020_v100.nc?srad[0:1:29][1236:1:1743][1346:1:1988]"</span></code></pre></div>
<p>While these is URL/OpenDAP based calls intended for subsetting over http, and will <em>not</em> work directyl on a local file, there is an internal function within <code>opendap.catalog</code> that converts OpenDAP strides (e.g. <code>[T][Y][X]</code>) to <code>RNetCDF</code> start/count syntax for local resources:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/dap_to_local.html">dap_to_local</a></span><span class="op">(</span><span class="va">cropped</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>, get <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Rows: 1</span>
<span class="co">#&gt; Columns: 5</span>
<span class="co">#&gt; $ file     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "/Users/mjohnson/Downloads/NEXGDM_srad_2020_v100.nc"</span>
<span class="co">#&gt; $ variable <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "srad"</span>
<span class="co">#&gt; $ start    <span style="color: #949494; font-style: italic;">&lt;I&lt;list&gt;&gt;</span> 1347, 12....</span>
<span class="co">#&gt; $ count    <span style="color: #949494; font-style: italic;">&lt;I&lt;list&gt;&gt;</span> 643, 508, 30</span>
<span class="co">#&gt; $ unpack   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> TRUE</span></code></pre></div>
<p>Now with our ideal extent defined, we need to get the data!</p>
</div>
<div class="section level3">
<h3 id="dap_get">
<code>dap_get()</code><a class="anchor" aria-label="anchor" href="#dap_get"></a>
</h3>
<p><code><a href="../reference/dap_get.html">dap_get()</a></code> can bring the data defined in either a URL or a <code><a href="../reference/dap_crop.html">dap_crop()</a></code> <code>data.frame</code> into R as a <code>SpatRast</code> object.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">srad</span> <span class="op">=</span> <span class="fu"><a href="../reference/dap_get.html">dap_get</a></span><span class="op">(</span><span class="va">cropped</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; $srad</span>
<span class="co">#&gt; class       : SpatRaster </span>
<span class="co">#&gt; dimensions  : 508, 643, 30  (nrow, ncol, nlyr)</span>
<span class="co">#&gt; resolution  : 1000, 1000  (x, y)</span>
<span class="co">#&gt; extent      : -1147045, -504045, 1566005, 2074005  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; coord. ref. : +proj=aea +lat_0=23 +lon_0=-96 +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +ellps=WGS84 +units=m +no_defs </span>
<span class="co">#&gt; source      : memory </span>
<span class="co">#&gt; names       : 2020-01-02, 2020-01-03, 2020-01-04, 2020-01-05, 2020-01-06, 2020-01-07, ... </span>
<span class="co">#&gt; min values  :   3.643555,   4.479492,   4.250977,   5.985352,   6.518555,   5.408203, ... </span>
<span class="co">#&gt; max values  :   9.180664,   8.987305,   9.541016,   9.202148,  10.203125,  10.263672, ... </span>
<span class="co">#&gt; unit        :     MJ/day,     MJ/day,     MJ/day,     MJ/day,     MJ/day,     MJ/day, ...</span></code></pre></div>
<p><img src="dap_utils_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="dap">
<code>dap()</code><a class="anchor" aria-label="anchor" href="#dap"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dap</span> <span class="op">=</span> <span class="fu"><a href="../reference/dap.html">dap</a></span><span class="op">(</span>URL <span class="op">=</span> <span class="va">url</span>, 
          AOI <span class="op">=</span> <span class="fu">AOI</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/AOI/man/aoi_get.html" class="external-link">aoi_get</a></span><span class="op">(</span>state <span class="op">=</span> <span class="st">"MI"</span><span class="op">)</span>, 
          startDate <span class="op">=</span> <span class="st">"2020-01-01"</span><span class="op">)</span>
<span class="co">#&gt; source:   /Users/mjohnson/Downloads/NEXGDM_srad_2020_v100.nc </span>
<span class="co">#&gt; varname(s):</span>
<span class="co">#&gt;    &gt; srad [MJ/day] (Shortwave radiation)</span>
<span class="co">#&gt; ==================================================</span>
<span class="co">#&gt; diminsions:  683, 718, 1 (names: x,y,time)</span>
<span class="co">#&gt; resolution:  1000, 1000, 1 days</span>
<span class="co">#&gt; extent:      428955, 1111955, 2117005, 2835005 (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs:         +proj=aea +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +u...</span>
<span class="co">#&gt; time:        2020-01-02 to 2020-01-02</span>
<span class="co">#&gt; ==================================================</span>
<span class="co">#&gt; values: 490,394 (vars*X*Y*T)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">dap</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ srad:Formal class 'SpatRaster' [package "terra"] with 1 slot</span>

<span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">dap</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="dap_utils_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="web-resource">Web Resource<a class="anchor" aria-label="anchor" href="#web-resource"></a>
</h2>
<p>For this example, lets say you want the monthly observational data used for <a href="http://gdo-dcp.ucllnl.org/downscaled_cmip_projections/dcpInterface.html" class="external-link">BCSD downscaling</a>. We know this data sits on a THREDDS data server maintained by the USGS.</p>
<p>Following the above examples for local file we can use the same process. This time we find the web-resource contains more then one variable:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"https://cida.usgs.gov/thredds/dodsC/bcsd_obs"</span>
<span class="fu"><a href="../reference/dap_summary.html">dap_summary</a></span><span class="op">(</span>url <span class="op">=</span> <span class="va">url</span><span class="op">)</span>
<span class="co">#&gt; source:   https://cida.usgs.gov/thredds/dodsC/bcsd_obs </span>
<span class="co">#&gt; varname(s):</span>
<span class="co">#&gt;    &gt; pr [mm/m] (monthly_sum_pr)</span>
<span class="co">#&gt;    &gt; prate [mm/d] (monthly_avg_prate)</span>
<span class="co">#&gt;    &gt; tas [C] (monthly_avg_tas)</span>
<span class="co">#&gt;    &gt; tasmax [C] (monthly_avg_tasmax)</span>
<span class="co">#&gt;    &gt; tasmin [C] (monthly_avg_tasmin)</span>
<span class="co">#&gt;    &gt; wind [m/s] (monthly_avg_wind)</span>
<span class="co">#&gt; ==================================================</span>
<span class="co">#&gt; diminsions:  462, 222, 600 (names: longitude,latitude,time)</span>
<span class="co">#&gt; resolution:  0.125, 0.125, 1 months</span>
<span class="co">#&gt; extent:      -124.75, -67, 25.12, 52.88 (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs:         +proj=longlat +a=6378137 +f=0.00335281066474748 +p...</span>
<span class="co">#&gt; time:        1950-01-31 to 1999-12-31</span>
<span class="co">#&gt; ==================================================</span>
<span class="co">#&gt; values: 369,230,400 (vars*X*Y*T)</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cropped</span> <span class="op">=</span> <span class="fu"><a href="../reference/dap_crop.html">dap_crop</a></span><span class="op">(</span><span class="va">url</span>, AOI <span class="op">=</span> <span class="fu">AOI</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/AOI/man/aoi_get.html" class="external-link">aoi_get</a></span><span class="op">(</span>state <span class="op">=</span> <span class="st">"CA"</span><span class="op">)</span>, startDate <span class="op">=</span> <span class="st">'1995-01-01'</span><span class="op">)</span>
<span class="co">#&gt; source:   https://cida.usgs.gov/thredds/dodsC/bcsd_obs </span>
<span class="co">#&gt; varname(s):</span>
<span class="co">#&gt;    &gt; pr [mm/m] (monthly_sum_pr)</span>
<span class="co">#&gt;    &gt; prate [mm/d] (monthly_avg_prate)</span>
<span class="co">#&gt;    &gt; tas [C] (monthly_avg_tas)</span>
<span class="co">#&gt;    &gt; tasmax [C] (monthly_avg_tasmax)</span>
<span class="co">#&gt;    &gt; tasmin [C] (monthly_avg_tasmin)</span>
<span class="co">#&gt;    &gt; wind [m/s] (monthly_avg_wind)</span>
<span class="co">#&gt; ==================================================</span>
<span class="co">#&gt; diminsions:  83, 77, 1 (names: longitude,latitude,time)</span>
<span class="co">#&gt; resolution:  0.125, 0.125, 1 months</span>
<span class="co">#&gt; extent:      -124.5, -114.12, 32.5, 42.12 (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs:         +proj=longlat +a=6378137 +f=0.00335281066474748 +p...</span>
<span class="co">#&gt; time:        1995-01-01 to 1995-01-01</span>
<span class="co">#&gt; ==================================================</span>
<span class="co">#&gt; values: 38,346 (vars*X*Y*T)</span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bcsd</span> <span class="op">=</span> <span class="fu"><a href="../reference/dap_get.html">dap_get</a></span><span class="op">(</span><span class="va">cropped</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">bcsd</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt; List of 6</span>
<span class="co">#&gt;  $ pr    :Formal class 'SpatRaster' [package "terra"] with 1 slot</span>
<span class="co">#&gt;  $ prate :Formal class 'SpatRaster' [package "terra"] with 1 slot</span>
<span class="co">#&gt;  $ tas   :Formal class 'SpatRaster' [package "terra"] with 1 slot</span>
<span class="co">#&gt;  $ tasmax:Formal class 'SpatRaster' [package "terra"] with 1 slot</span>
<span class="co">#&gt;  $ tasmin:Formal class 'SpatRaster' [package "terra"] with 1 slot</span>
<span class="co">#&gt;  $ wind  :Formal class 'SpatRaster' [package "terra"] with 1 slot</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="fu"><a href="../reference/dap_get.html">dap_get</a></span><span class="op">(</span><span class="va">cropped</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; $pr</span>
<span class="co">#&gt; class       : SpatRaster </span>
<span class="co">#&gt; dimensions  : 77, 83, 1  (nrow, ncol, nlyr)</span>
<span class="co">#&gt; resolution  : 0.125, 0.125  (x, y)</span>
<span class="co">#&gt; extent      : -124.5, -114.125, 32.5, 42.125  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; coord. ref. : +proj=longlat +ellps=WGS84 +no_defs </span>
<span class="co">#&gt; source      : memory </span>
<span class="co">#&gt; name        : 1995-01-01 </span>
<span class="co">#&gt; min value   :       1.51 </span>
<span class="co">#&gt; max value   :    1545.87 </span>
<span class="co">#&gt; unit        :       mm/m</span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cropped_wind</span> <span class="op">=</span> <span class="fu"><a href="../reference/dap_crop.html">dap_crop</a></span><span class="op">(</span><span class="va">url</span>, <span class="va">AOI</span>, startDate <span class="op">=</span> <span class="st">'1995-01-01'</span>, varname <span class="op">=</span> <span class="st">'wind'</span><span class="op">)</span>
<span class="co">#&gt; source:   https://cida.usgs.gov/thredds/dodsC/bcsd_obs </span>
<span class="co">#&gt; varname(s):</span>
<span class="co">#&gt;    &gt; wind [m/s] (monthly_avg_wind)</span>
<span class="co">#&gt; ==================================================</span>
<span class="co">#&gt; diminsions:  462, 222, 1 (names: longitude,latitude,time)</span>
<span class="co">#&gt; resolution:  0.125, 0.125, 1 months</span>
<span class="co">#&gt; extent:      -124.75, -67, 25.12, 52.88 (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs:         +proj=longlat +a=6378137 +f=0.00335281066474748 +p...</span>
<span class="co">#&gt; time:        1995-01-01 to 1995-01-01</span>
<span class="co">#&gt; ==================================================</span>
<span class="co">#&gt; values: 102,564 (vars*X*Y*T)</span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cropped_wind2</span> <span class="op">=</span> <span class="fu"><a href="../reference/dap_crop.html">dap_crop</a></span><span class="op">(</span><span class="va">url</span>, <span class="va">AOI</span>, startDate <span class="op">=</span> <span class="st">'1995-01-01'</span>, varname <span class="op">=</span> <span class="st">'wind'</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dap</span> <span class="op">=</span> <span class="fu"><a href="../reference/dap.html">dap</a></span><span class="op">(</span>URL <span class="op">=</span> <span class="st">"https://cida.usgs.gov/thredds/dodsC/bcsd_obs"</span>, 
          AOI <span class="op">=</span> <span class="fu">AOI</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/AOI/man/aoi_get.html" class="external-link">aoi_get</a></span><span class="op">(</span>state <span class="op">=</span> <span class="st">"MI"</span><span class="op">)</span>, 
          startDate <span class="op">=</span> <span class="st">"1995-01-01"</span><span class="op">)</span>
<span class="co">#&gt; source:   https://cida.usgs.gov/thredds/dodsC/bcsd_obs </span>
<span class="co">#&gt; varname(s):</span>
<span class="co">#&gt;    &gt; pr [mm/m] (monthly_sum_pr)</span>
<span class="co">#&gt;    &gt; prate [mm/d] (monthly_avg_prate)</span>
<span class="co">#&gt;    &gt; tas [C] (monthly_avg_tas)</span>
<span class="co">#&gt;    &gt; tasmax [C] (monthly_avg_tasmax)</span>
<span class="co">#&gt;    &gt; tasmin [C] (monthly_avg_tasmin)</span>
<span class="co">#&gt;    &gt; wind [m/s] (monthly_avg_wind)</span>
<span class="co">#&gt; ==================================================</span>
<span class="co">#&gt; diminsions:  68, 54, 1 (names: longitude,latitude,time)</span>
<span class="co">#&gt; resolution:  0.125, 0.125, 1 months</span>
<span class="co">#&gt; extent:      -90.5, -82, 41.62, 48.38 (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs:         +proj=longlat +a=6378137 +f=0.00335281066474748 +p...</span>
<span class="co">#&gt; time:        1995-01-01 to 1995-01-01</span>
<span class="co">#&gt; ==================================================</span>
<span class="co">#&gt; values: 22,032 (vars*X*Y*T)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">dap</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt; List of 6</span>
<span class="co">#&gt;  $ pr    :Formal class 'SpatRaster' [package "terra"] with 1 slot</span>
<span class="co">#&gt;  $ prate :Formal class 'SpatRaster' [package "terra"] with 1 slot</span>
<span class="co">#&gt;  $ tas   :Formal class 'SpatRaster' [package "terra"] with 1 slot</span>
<span class="co">#&gt;  $ tasmax:Formal class 'SpatRaster' [package "terra"] with 1 slot</span>
<span class="co">#&gt;  $ tasmin:Formal class 'SpatRaster' [package "terra"] with 1 slot</span>
<span class="co">#&gt;  $ wind  :Formal class 'SpatRaster' [package "terra"] with 1 slot</span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dap</span> <span class="op">=</span> <span class="fu"><a href="../reference/dap.html">dap</a></span><span class="op">(</span>URL <span class="op">=</span> <span class="st">"https://cida.usgs.gov/thredds/dodsC/bcsd_obs"</span>, 
          AOI <span class="op">=</span> <span class="fu">AOI</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/AOI/man/aoi_get.html" class="external-link">aoi_get</a></span><span class="op">(</span>state <span class="op">=</span> <span class="st">"MI"</span><span class="op">)</span>, 
          startDate <span class="op">=</span> <span class="st">"1995-01-01"</span>, 
          verbose <span class="op">=</span> <span class="cn">FALSE</span>,
          varname <span class="op">=</span> <span class="st">"pr"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">dap</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ pr:Formal class 'SpatRaster' [package "terra"] with 1 slot</span></code></pre></div>
<p><img src="dap_utils_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Mike Johnson.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
